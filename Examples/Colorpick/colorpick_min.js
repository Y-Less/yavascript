var $_info=(function(){var C=window['console'];if(C)return function(msg,level){level=level||0;if(5>=level)C(msg)};else return function(msg,level){level=level||0;if(5>=level)alert(msg)}})();function $error(error,level){if((!level)||5>=level){$_info('Error: '+error,level);alert('Error: '+error)}}function $warning(warning,level){if((!level)||5>=level){$_info('Warning: '+warning,level);alert('Warning: '+warning)}}function $debug(debug,level){$_info('Debug: '+debug,level)}function $info(info,level){$_info('Info: '+info,level)}function $class(constructor,properties,statics){if(!constructor)constructor=(new Function());var prot=constructor.prototype;if(properties)for(var i in properties)prot[i]=properties[i];if(statics)for(var i in statics)constructor[i]=statics[i];prot.constructor=constructor;prot.$base=null;constructor.$base=null;prot.$isA=$class.isA;constructor.$isA=$class.isA;return constructor}$class.extend=function(){var code=arguments.length-3,oldProt;if(code<1){$error('Must include at least one parent class.');return null}if(code==1){var parent=arguments[0],constructor=arguments[1];if(constructor==null)constructor=function(){var pars='';for(var i=0,j=arguments.length;i<j;i++)pars+=', arguments['+i+']';eval('parent.prototype.constructor.call(this'+pars+');')};oldProt=constructor.prototype;var prot;constructor.prototype=prot=(new parent());for(var i in oldProt)prot[i]=oldProt[i];constructor=$class(constructor,arguments[2],arguments[3]);prot.$base=parent.prototype;constructor.$base=parent;return constructor}else{var constructor=arguments[code],parent=[];for(var i=0;i<code;i++)parent[i]=arguments[i];if(constructor==null)constructor=function(){var pars='parent[i].prototype.constructor.call(this';for(var i=0,j=arguments.length;i<j;i++)pars+=', arguments['+i+']';pars+=');';for(var i in parent)eval(pars)};oldProt=constructor.prototype;var k=code-1;for(var i=0;i<k;i++){constructor.prototype=(new parent[i]());var cp=constructor.prototype;for(var j in cp)oldProt[j]=cp[j]}constructor.prototype=(new parent[k]());k=constructor.prototype;for(var i in oldProt)if((typeof k[i])=='undefined')k[i]=oldProt[i];k.constructor=constructor;constructor=$class(constructor,arguments[code+1],arguments[code+2]);constructor.prototype.$base=parent.prototype;constructor.$base=parent;return constructor}};$class.isA=function(compare){var base=this;while(base){if(base==compare)return true;base=base.$base}return false};function $event(domEvent,source,func){$event=$event._eventHandler;return $event(domEvent,source,func)}$event.add=$event;$event._eventHandler=function(domEvent,source,func){if(!func){if(!source)return;func=source;source=document}domEvent=domEvent.substring(0,2)=='on'?domEvent:'on'+domEvent;var ev=source[domEvent];if(ev){if(!ev._has$event){var old=ev;ev=function(event){event=event||window.event;var c=ev._calls,i=-1,j=c.length,oldStop=event.stopPropagation,ret=false;event.cancelBubble=false;event.stopPropagation=function(){event.cancelBubble=true};if(old.call(this,event))ret=true;while(++i<j)if(c[i])if(c[i].call(this,event))ret=true;if(oldStop&&event.cancelBubble)oldStop();return ret};ev._calls=[]}}else{ev=function(event){event=event||window.event;var c=ev._calls,i=-1,j=c.length,oldStop=event.stopPropagation,ret=false;event.cancelBubble=false;event.stopPropagation=function(){event.cancelBubble=true};while(++i<j)if(c[i])if(c[i].call(this,event))ret=true;if(oldStop&&event.cancelBubble)oldStop();return ret};ev._calls=[]}ev._calls[ev._calls.length]=func;ev._has$event=true;source[domEvent]=ev};$event._addEventListener=function(domEvent,source,func){if(!func){if(!source)return;func=source;source=document}var nf;if(!func._$_event_$_handler_$_)func._$_event_$_handler_$_=[];if(!func._$_event_$_handler_$_[domEvent]){nf=function(event){event=event||window.event;var ret=func.call(source,event);if(!ret){if(event.preventDefault)event.preventDefault();else event.returnValue=false;return false}return true};func._$_event_$_handler_$_[domEvent]=nf}else nf=func._$_event_$_handler_$_[domEvent];domEvent=domEvent.substring(0,2)=='on'?domEvent.substring(2):domEvent;source.addEventListener(domEvent,nf,false)};$event.remove=function(domEvent,source,func){if(!func){func=source;source=document}if(!source.removeEventListener)source.removeEventListener=function(type,listener,useCapture){type='on'+type;var old=source[type];if(old)if(old._first==listener){old._first=null;return}else{var list=old._calls;if(list){var i=-1,j=list.length;while(++i<j)if(list[i].func==listener){list[i]=null;return}}}};domEvent=domEvent.substring(0,2)=='on'?domEvent.substring(2):domEvent;source.removeEventListener(domEvent,func._$_event_$_handler_$_[domEvent],false)};var CUtils=$class(null,null,{GetElementPos:function(element){var left=0,top=0;do{left+=element.offsetLeft;top+=element.offsetTop;element=element.offsetParent}while(element)return{x:left,y:top}},GetElementSize:function(element){if((typeof element.offsetWidth)=='undefined')return{x:element.style.pixelWidth,y:element.style.pixelHeight};else return{x:element.offsetWidth,y:element.offsetHeight}},ToHex:function(num,pad){var ret='';do{ret=CUtils.HEX.substr(num&15,1)+ret;num>>=4}while(num>0)if(pad)while(ret.length<pad)ret='0'+ret;return ret},GetMousePos:function(event){if((typeof event.pageX)!='undefined')return{x:event.pageX,y:event.pageY};if(event.clientX)return{x:event.clientX+document.body.scrollLeft-document.body.clientLeft,y:event.clientY+document.body.scrollTop-document.body.clientTop};return{x:0,y:0}},GetElement:function(element){var type=(typeof element);if(type=='undefined')return null;if(type=='string')return $(element);if(type=='function')return element();return element},GetScrollPos:function(){return{x:document.all?document.body.scrollLeft:window.pageXOffset,y:document.all?document.body.scrollTop:window.pageYOffset}},GetScreenSize:function(){return{x:screen.width,y:screen.height}},GetElementsByClassName:function(className,elm,tag){if(document.getElementsByClassName)CUtils.GetElementsByClassName=function(className,elm,tag){elm=elm||document;var elements=elm.getElementsByClassName(className),nodeName=tag?(new RegExp('\\b'+tag+'\\b','i')):null,returnElements=[],current;for(var i=0,il=elements.length;i<il;i+=1){current=elements[i];if((!nodeName)||nodeName.test(current.nodeName))returnElements.push(current)}return returnElements};else if(document.evaluate)CUtils.GetElementsByClassName=function(className,elm,tag){tag=tag||'*';elm=elm||document;var classes=className.split(' '),classesToCheck='',xhtmlNamespace='http://www.w3.org/1999/xhtml',namespaceResolver=document.documentElement.namespaceURI===xhtmlNamespace?xhtmlNamespace:null,returnElements=[],elements,node;for(var j=0,jl=classes.length;j<jl;j+=1)classesToCheck+="[contains(concat(' ', @class, ' '), ' "+classes[j]+" ')]";try{elements=document.evaluate('.//'+tag+classesToCheck,elm,namespaceResolver,0,null)}catch(e){elements=document.evaluate('.//'+tag+classesToCheck,elm,null,0,null)}while(node=elements.iterateNext())returnElements.push(node);return returnElements};else CUtils.GetElementsByClassName=function(className,elm,tag){tag=tag||'*';elm=elm||document;var classes=className.split(' '),classesToCheck=[],elements=tag==='*'&&elm.all?elm.all:elm.getElementsByTagName(tag),current,returnElements=[],match;for(var k=0,kl=classes.length;k<kl;k+=1)classesToCheck.push(new RegExp('(^|\\s)'+classes[k]+'(\\s|$)'));for(var l=0,ll=elements.length;l<ll;l+=1){current=elements[l];match=false;for(var m=0,ml=classesToCheck.length;m<ml;m+=1){match=classesToCheck[m].test(current.className);if(!match)break}if(match)returnElements.push(current)}return returnElements};return CUtils.GetElementsByClassName(className,elm,tag)},MAX:2147483647,MIN:-2147483648,HEX:'0123456789ABCDEF'});var CDragable=$class(function(dragHandle,movableItem){dragHandle=CUtils.GetElement(dragHandle);movableItem=CUtils.GetElement(movableItem);if(dragHandle)if(movableItem)this.SetElements(dragHandle,movableItem);else this.SetElements(dragHandle,dragHandle)},{SetElements:function(dragHandle,movableItem){dragHandle.oParent=this;movableItem.style.position='relative';$event('onmousedown',dragHandle,CDragable.OnMouseDown);this.eElement=dragHandle;this.eMovable=movableItem;this.UpdatePos()},OnDragStart:function(x,y){this.mX=x;this.mY=y;if(this.OnStart)this.OnStart()},OnDragStop:function(){if(this.OnStop)this.OnStop()},OnDragMove:function(x,y){this.Move(x-this.mX,y-this.mY);this.mX=x;this.mY=y},Move:function(dX,dY){this.SetPos(this.mEX+dX,this.mEY+dY)},SetPos:function(x,y){var s=this.eMovable.style,dx=x-this.mEX,dy=y-this.mEY;this.mEX=x;this.mEY=y;s.left=x+'px';s.top=y+'px';if(this.OnMove)this.OnMove(dx,dy)},SetPosAbs:function(x,y){var rpos=CUtils.GetElementPos(this.eMovable);this.Move(x-rpos.x,y-rpos.y)},GetPos:function(){return{x:this.mEX,y:this.mEY}},UpdatePos:function(){var pos=CUtils.GetElementPos(this.eMovable),t=this.OnMove;this.OnMove=null;this.SetPosAbs(pos.x,pos.y);this.OnMove=t},mX:0,mY:0,mEX:0,mEY:0,mScroll:true},{OnMouseDown:function(event){var pos=CUtils.GetMousePos(event),d=CDragable.msDrag;if(d)d.OnDragStop();d=this.oParent;if(d.mScroll)d.OnDragStart(pos.x,pos.y);else d=null;CDragable.msDrag=d;return false},OnMouseUp:function(event){if(CDragable.msDrag){CDragable.msDrag.OnDragStop();CDragable.msDrag=null}return false},OnMouseMove:function(event){if(CDragable.msDrag){var pos=CUtils.GetMousePos(event);CDragable.msDrag.OnDragMove(pos.x,pos.y);return false}return true},msDrag:null});$event('onmouseup',CDragable.OnMouseUp);$event('onmousemove',CDragable.OnMouseMove);var CDragRestrict=$class.extend(CDragable,null,{SetArea:function(minx,miny,maxx,maxy){this.mMinX=minx;this.mMinY=miny;this.mMaxX=maxx;this.mMaxY=maxy},Move:function(dX,dY){this.SetPos(this.mRX+dX,this.mRY+dY)},SetPos:function(x,y){this.mRX=x;this.mRY=y;if(x<this.mMinX)x=this.mMinX;if(y<this.mMinY)y=this.mMinY;if(x>=this.mMaxX)x=this.mMaxX;if(y>=this.mMaxY)y=this.mMaxY;CDragable.prototype.SetPos.call(this,x,y)},mMinX:0,mMinY:0,mMaxX:CUtils.MAX,mMaxY:CUtils.MAX,mRX:0,mRY:0},null);var CParts=$class(null,null,{MakeIcon:function(file,width,height,offset,func){if((typeof func)=='undefined'){if((typeof offset)=='undefined'){if((typeof height)=='undefined'){func=width;offset=-file;width=16;file='Images/buttons.png'}else{func=height;offset=0}height=width}else{func=offset;offset=0}}else offset=-offset;var ret=(new Image()),s=ret.style;ret.src='Images/dot.gif';s.width=width+'px';s.height=height+'px';s.backgroundImage='url('+file+')';s.backgroundPosition=offset+'px 0px';height=-height;var onicon=0;$event('onmousedown',ret,function(event){s.backgroundPosition=offset+'px '+height+'px';onicon=1;CParts.msAllUp=1;event.stopPropagation()});$event('onmouseup',ret,function(event){if(onicon==1){func();s.backgroundPosition=offset+'px 0px';event.stopPropagation()}onicon=0});$event('onmouseout',ret,function(){if(onicon==1){s.backgroundPosition=offset+'px 0px';onicon=2}});$event('onmouseover',ret,function(){if(!CParts.msAllUp)onicon=0;if(onicon==2){onicon=1;s.backgroundPosition=offset+'px '+height+'px'}});return ret},msAllUp:0});$event('onmouseup',function(){CParts.msAllUp=0});var CWindow=$class.extend(CDragable,function(title,dragHandle){if((typeof dragHandle)=='undefined'){this.windowTitle='';CDragable.prototype.constructor.call(this,title,title)}else{this.windowTitle=title;CDragable.prototype.constructor.call(this,dragHandle,dragHandle)}},{SetElements:function(dragHandle_IGNORE_,movableItem){var parent,window=document.createElement('div'),temp,cn=function(e){return CUtils.GetElementsByClassName(e,window)[0]};window.className='ysi_window_outer ysi_window_outer_min';window.innerHTML='<div class="ysi_window_container"><div class="ysi_window_fit"><div class="ysi_window_content"><div class="ysi_window_inner"></div></div><div class="ysi_window_bar"><div class="ysi_window_icons"></div></div></div></div>';;movableItem.parentNode.appendChild(window);cn('ysi_window_inner').appendChild(movableItem);parent=cn('ysi_window_icons');var lthis=this;parent.appendChild(CParts.MakeIcon(32,function(){alert('click')}));this.bMax=CParts.MakeIcon(16,function(){lthis.Maximise()});parent.appendChild(this.bMax);this.bRes=CParts.MakeIcon(48,function(){lthis.Restore()});this.bRes.style.display='none';parent.appendChild(this.bRes);parent.appendChild(CParts.MakeIcon(0,function(){lthis.eMovable.style.display='none'}));temp=cn('ysi_window_bar');CDragable.prototype.SetElements.call(this,temp,window);this.maxState=false;$event('ondblclick',temp,function(){if(lthis.maxState)lthis.Restore();else lthis.Maximise()});parent=document.createElement('span');parent.innerHTML=this.windowTitle;this.eWindowTitle=parent;temp.appendChild(parent);parent=cn('ysi_window_content');parent.style.paddingTop=temp.offsetHeight+'px';temp=CUtils.GetScreenSize();this.SetPos((temp.x-window.clientWidth)/2,(temp.y-window.clientHeight)/2);this.Maximise();this.Restore()},Maximise:function(){this.bRes.style.display='block';this.bMax.style.display='none';var m=this.eMovable,s=m.style,pos=CUtils.GetScrollPos();this.iOldWidth=m.clientWidth;this.iOldHeight=m.clientHeight;m.className='ysi_window_outer ysi_window_outer_max';s.left=pos.x+'px';s.top=pos.y+'px';s.width='100%';s.height='100%';this.mScroll=false;this.maxState=true},Restore:function(){this.bRes.style.display='none';this.bMax.style.display='block';var s=this.eMovable.style;this.eMovable.className='ysi_window_outer ysi_window_outer_min';s.left=this.mEX+'px';s.top=this.mEY+'px';s.width=this.iOldWidth;s.height=this.iOldHeight;this.mScroll=true;this.maxState=false},SetTitle:function(title){this.eWindowTitle.innerHTML=title},GetHandle:function(){return this.eMovable}},null);var gBase;function $(el){return document.getElementById(el)}function Gradiate(base,pos){var h=51/2;if(pos<h)return 255-(255-base)*pos/h;else return base-base*(pos-h)/h}function Scale(col,y){if(col>127)return col-y*(col-127)/256;else return col+y*(127-col)/256}function Inc(x,seg){return 1530*x/256-255*seg}function Dec(x,seg){return 255*(seg+1)-1530*x/256}function GetColor(x,y){var r,g,b;if(x<256*1/6)r=255,g=Inc(x,0),b=0;else if(x<256*2/6){r=Dec(x,1);g=255;b=0}else if(x<256*3/6){r=0;g=255;b=Inc(x,2)}else if(x<256*4/6){r=0;g=Dec(x,3);b=255}else if(x<256*5/6){r=Inc(x,4);g=0;b=255}else{r=255;g=0;b=Dec(x,5)}return{r:Scale(r,y),g:Scale(g,y),b:Scale(b,y)}}function DrawGradient(base){var grad='';for(var i=0;i<51;i++){var r=Gradiate(base.r,i),g=Gradiate(base.g,i),b=Gradiate(base.b,i);grad+='<img src="Images/dot.gif" style="background-color: rgb('+Math.round(r)+','+Math.round(g)+','+Math.round(b)+'); height: '+5+'px;">'}$('grad').innerHTML=grad}$event('onload',window,function(event){var selection=(new CWindow('Select color','picker')),image=$('pick_image'),pick=$('pick_pointer');{pickObj=(new CDragRestrict(pick));pos0=CUtils.GetElementPos(image);pos1=CUtils.GetElementPos(pick);size=CUtils.GetElementSize(pick)}gBase=GetColor(10,10);DrawGradient(gBase);pos0.x-=pos1.x+size.x/2;pos0.y-=pos1.y+size.y/2;pickObj.SetArea(pos0.x+1,pos0.y+1,pos0.x+256-1,pos0.y+256-1);pickObj.SetPos(pos0.x+10,pos0.y+10);pickObj.OnMove=function(dx,dy){var epos=CUtils.GetElementPos(image),mpos=CUtils.GetElementPos(this.eMovable);gBase=GetColor(mpos.x-epos.x+size.x/2,mpos.y-epos.y+size.x/2);DrawGradient(gBase)};$event('onclick',image,function(event){var mpos=CUtils.GetMousePos(event);pickObj.SetPosAbs(mpos.x-size.x/2,mpos.y-size.y/2)});$event('onclick',$('grad'),function(event){var y=CUtils.GetMousePos(event).y-CUtils.GetElementPos(this).y,r=Math.round(Gradiate(gBase.r,y)),g=Math.round(Gradiate(gBase.g,y)),b=Math.round(Gradiate(gBase.b,y));alert('#'+CUtils.ToHex(r,2)+CUtils.ToHex(g,2)+CUtils.ToHex(b,2)+' ('+r+', '+g+', '+b+')')})})